var codeinjector={cache:null,init:function(){api.executeIfPermission(function(){codeinjector.executeCodeOnAllTabs("init")},function(){chrome.permissions.onAdded.addListener(function(){codeinjector.executeCodeOnAllTabs("init")})}),codeinjector.addListeners()},addListeners:function(){chrome.tabs.onUpdated.addListener(function(e,t,n){"complete"==t.status&&api.executeIfPermission(function(){codeinjector.executeOnTab(e,n)})})},executeCodeOnAllTabs:function(e){var t;t="init"==(e=e||"init")?codeinjector.getCode():e,chrome.tabs.query({},function(e){for(var n=0;n<e.length;n++)codeinjector.isIgnored(e[n].url)||chrome.tabs.executeScript(e[n].id,{code:t},function(){chrome.runtime.lastError&&console.info(chrome.runtime.lastError)})})},executeOnTab:function(e,t,n,o){if(codeinjector.isIgnored(t.url))setTimeout(o,0);else{var i={code:codeinjector.getCode()};n&&(i.runAt="document_start"),chrome.tabs.executeScript(e,i,o)}},isIgnored:function(e){return e.match(/^chrom.*:\/\//)||e.match(/^opera:\/\//)},getCode:function(){if(codeinjector.cache&&!settings.dev)return codeinjector.cache;var e=["libs/jquery.js","js/common.js","js/cropper.js","js/pluginsBuiltIn.js","js/pluginLib.js","js/plugin.js","js/intab.js"],t="";t+="var settings = "+JSON.stringify(settings)+";",t+="var data = "+JSON.stringify({version:extension.version,special_shortcut_full:localStorage.shortcut_full,special_shortcut_visible:localStorage.shortcut_visible,special_shortcut_region:localStorage.shortcut_region})+";",settings.dev&&console.time("getCode");for(var n=0;n<e.length;n++)settings.dev&&(t+='console.time("'+e[n]+'");'),t+=$.ajax({url:e[n],async:!1}).responseText+"\r\n;// ff:"+e[n]+"\r\n",settings.dev&&(t+='console.timeEnd("'+e[n]+'");');return settings.dev&&console.timeEnd("getCode"),t="if(!window.alreadyRun) {window.alreadyRun=true;"+t+"}",codeinjector.cache=t,t}};