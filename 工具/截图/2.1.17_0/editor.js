var canvasToDataURL;if(String.prototype.twoDigits=function(){return this.replace(/^(.)$/,"0$1")},extension.online)var screenshot=chrome.extension.getBackgroundPage().screenshot;var imageURL,imageId,shadowDistance=5;function editor_obj(){var t,e,o,n,s,r,c,d,l,h,u,p="#ff0000",g=2,f=5,v={current:"line",status:"ready"},m={rx1:0,rx2:0,ry1:0,ry2:0},w=!1;v.free={},v.highlight={},v.spray={},v.line={},v.rectangle={},v.full={},v.arrow={},v.star={},v.house={},v.ellipsis={},v.crop={},v.text={},v.undo={},v.redo={};var C,k=[],T=-1,D=-1,S=!0;function O(e){S=!0,T++,D++,k.length>T&&(k.slice(T),D=T),e||(e={});var a=jQuery.extend(!0,{},e);return a.canvas=t,a.c=o,a=$.extend(!0,a,m),k[T]=a,(C=a).active=!0,C.color=p,C.lineWidth=g,F(),a}function L(){e=$("<canvas class=tool style=position:relative></canvas>").appendTo($("#clipper"));var a=$("<img>").appendTo("#clipper");e.data("img",a),t=e[0],o=t.getContext("2d"),t.width=s.width(),t.height=s.height(),e.data("level",C),C.canvas=t,C.c=o,e.add(a).css({"margin-left":-m.rx1,"margin-top":-m.ry1}),e.add(a).css({position:"absolute","z-index":f++,left:0,co:s.position().left,top:0,color:s.offset().top-h})}function I(t){return ans={x:m.rx1+t.pageX-$("#divCanvasData").offset().left+$("#divCanvasData").scrollLeft(),y:m.ry1+t.pageY-$("#divCanvasData").offset().top+$("#divCanvasData").scrollTop()},!(ans.x<0||ans.y<0)&&(!(t.pageX>$("#divCanvasData").offset().left+$("#divCanvasData").width()-d)&&(!(t.pageY>$("#divCanvasData").offset().top+$("#divCanvasData").height()-l)&&(!(t.pageX<$("#divCanvasData").offset().left)&&(!(t.pageY<$("#divCanvasData").offset().top)&&ans))))}function R(t){return x1=y1=65535,x2=y2=0,$.each(t,function(t,e){e.x<x1&&(x1=e.x),e.x>x2&&(x2=e.x),e.y<y1&&(y1=e.y),e.y>y2&&(y2=e.y)}),{x1:x1,x2:x2,y1:y1,y2:y2}}v.undo.click=function(){S=!0,"delete"==C.type?(C.item.add(C.item.data("img")).fadeIn(),C.item.data("deleted",!1),C.hide=null,C=k[--T]):"crop"==C.type?(C=k[--T],T<0?(m.rx1=m.ry1=0,m.ry2=$("#imgFixForLong").height(),m.rx2=$("#imgFixForLong").width()):(C=k[T],m.rx1=C.rx1,m.rx2=C.rx2,m.ry1=C.ry1,m.ry2=C.ry2),A()):(C.canvas.style.display="none",$(C.canvas).data("img").hide(),C=k[--T]),U("line"),F()},v.redo.click=function(){S=!0,"delete"==(C=k[++T]).type?(C.item.add(C.item.data("img")).fadeOut(),C.item.data("deleted",!0),C.hide=!0):"crop"==C.type?(m.rx1=C.rx1,m.rx2=C.rx2,m.ry1=C.ry1,m.ry2=C.ry2,A()):(C.canvas.style.display="",$(C.canvas).data("img").show()),U("line"),F()},this.createLastCanvas=function(t,e){if(e=e||{},S!=localStorage.pngjpg){var o=$("<canvas style=display:none; class=done></canvas>")[0];o.width=m.rx2-m.rx1,o.height=m.ry2-m.ry1,$("#border1").hasClass("on")&&(o.width+=10,o.height+=10);var n=o.getContext("2d");n.drawImage($("#imgFixForLong")[0],m.rx1,m.ry1,m.rx2-m.rx1,m.ry2-m.ry1,0,0,m.rx2-m.rx1,m.ry2-m.ry1);for(var i=0;i<=T;i++){if(w)return void Y();var s=k[i];s.canvasOffset={x:m.rx1,y:m.ry1},"crop"==s.type||"delete"==s.type||s.hide||v[s.type].draw({canvas:o,ctx:n,data:s})}S=localStorage.pngjpg,$("#border1").hasClass("on"),document.body.appendChild(o),canvasToDataURL="png"==localStorage.pngjpg?o.toDataURL():o.toDataURL("image/jpeg")}if("toolbar"!=t){if("save"==t)if(Y(),window.webkitIntent&&"http://webintents.org/edit"==webkitIntent.action)webkitIntent.postResult(canvasToDataURL);else{var r;dataURItoBlob=function(t){for(var e=atob(t.split(",")[1]),a=[],o=0;o<e.length;o++)a.push(e.charCodeAt(o));return new Blob([new Uint8Array(a)],{type:"image/jpeg"})},x=dataURItoBlob(canvasToDataURL),url=URL.createObjectURL(x),r=(r=screenshot.title||screenshot.url).replace(/[%&\(\)\\\/\:\*\?\"\<\>\|\/\]]/g," "),r+="png"==localStorage.pngjpg?".png":".jpg";var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!0,!1,!1,0,null),a=$("<a></a>").appendTo(document.body),a.attr({href:url,download:r})[0].dispatchEvent(c),S=!1}if("share"==t&&E(e),"open"==t){createFile(function(t){window.open(t,"_topopen"),"true"==localStorage.autosave&&window.close()}),$("#share").add("#save").add("#open").add("#print").attr("disabled","")}"toGoogleDrive"==t&&(gDrive(),S=!0,Y()),"print"==t&&(S=!1,$("#toPrintImage").one("load",function(){Y(),canvasWidth<700?(this.width=canvasWidth,$(this).css("width","")):(this.width=null,$(this).css("width","100%")),window.print()}),$("#toPrintImage")[0].src=canvasToDataURL)}else e(canvasToDataURL)},this.reloadCanvas=function(){screenshot.url&&$("title").html(screenshot.url),m.rx1=0,m.rx2=n.width,m.ry1=0,m.ry2=n.height,A(),F(),$("#toolbar .button[tag="+localStorage.lastTool+"]").trigger("click")},this.init=function(){var e;$("#wColorPicker2_3").wColorPicker({theme:"blue",mode:"hover",showSpeed:300,hideSpeed:300,buttonSize:46,initColor:localStorage.color||"#FF0000",onSelect:function(t){localStorage.color=t,p=t}}).on("mousedown",function(t){return t.stopPropagation(),!1}),$("#divCanvasData").on("mousemove",function(t){"ready"!=v.status&&"text"!=v.current||($("#divCanvasData").position(),$("canvas").each(function(e,a){if(!(e<2)){var o=$(a);gc=o[0].getContext("2d"),x=t.offsetX+t.target.offsetLeft-o.position().left+m.rx1,y=t.offsetY+t.target.offsetTop-o.position().top+m.ry1;var n=!1;if(x>0&&y>0&&x<a.width&&y<a.height&&"none"!=a.style.display){id=gc.getImageData(x,y,1,1).data,n=0;for(var i=0;i<4;i++)0!=id[i]&&(n=!0)}if(n){o.css({border:"2px dahed gray"});var s=o,r=o.data("close")||function(){s.css({border:"none"}),o.data("myClose").remove(),o.data("myClose",!1),o.data("close",!1)};clearTimeout(o.data("time"));var c=setTimeout(r,3e3);if(o.data("close",r),o.data("time",c),o.data("myClose"))return!1;var d=$('<div class="myClose">&times;</div>').css({left:o.position().left+o.width()-10-m.rx1,top:o.position().top-m.ry1,zIndex:1e3});return(d=d.appendTo("#divCanvasData").click(function(t){t.stopImmediatePropagation(),s.add(s.data("img")).fadeOut(),d.remove()}).mousedown(function(t){t.stopImmediatePropagation(),O(),C.type="delete",C.item=s,s.data("deleted",!0),s.data("level").hide=!0})).position().left>m.rx2-m.rx1&&d.css("left",m.rx2-m.rx1-30),d.position().top<0&&d.css("top",0),o.data("myClose",d),!1}}}))}),$("anvas.tool").on("mousemove",function(t){e=$(this),x=t.offsetX,y=t.offsetY,doIt=!1;for(var a=0;a<4;a++)0!=e[0].getContext("2d").getImageData(x,y,x,y).data[a]&&(doIt=!0);doIt&&($(".myBorder").remove(0),"started"!=v.status&&(myBorder=$("<div class=myBorder style='position:relative;border:1px dashed 00eeff;z-index:1000;ursor:move'><div style=position:absolute;width:10;height:10;top:0;right:0;cursor:pointer>X</div></div>").appendTo("#divCanvasData"),myBorder.css({left:$(this).position().left+$("#divCanvasData").scrollLeft(),top:$(this).position().top+$("#divCanvasData").scrollTop(),width:$(this).width(),height:$(this).height()}),myBorder.mouseleave(function(){myBorder.remove()}),myBorder.click(function(){e.remove(),myBorder.remove()}),$("div",myBorder).mouseenter(function(){v.status="moving"})))}),n=document.getElementById("canvasId"),s=$(n),j(),F(),screenshot.webcam&&(editor.webcam=!0,ctx=$("canvas")[0].getContext("2d"),t=$("canvas")[0],img=$("<img />")[0],img.onload=function(){t.width=this.width,t.height=this.height,u=this,ctx.drawImage(this,0,0),editor.reloadCanvas(),screenshot.webcam=null},img.src=screenshot.webcam),screenshot.apppick&&(editor.apppick=!0,ctx=$("canvas")[0].getContext("2d"),t=$("canvas")[0],img=$("<img />")[0],img.onload=function(){t.width=this.width,t.height=this.height,u=this,ctx.drawImage(this,0,0),editor.reloadCanvas(),screenshot.apppick=null},img.src=screenshot.apppick),"#last"==location.hash&&screenshot.canvas&&(t=$("canvas")[1],img=$("#imgFixForLong")[0],img.onload=function(){t.width=this.width,t.height=this.height,u=this,t.getContext("2d").drawImage(this,0,0),editor.reloadCanvas()},img.src=screenshot.canvas.toDataURL(),screenshot.callback=null,delete screenshot.callback,screenshot.canvas.width=screenshot.canvas.height=1,screenshot.callback=null,screenshot.canvas.remove(),screenshot.canvas=null,delete screenshot.canvas),window.webkitIntent&&(ctx=$("canvas")[0].getContext("2d"),t=$("canvas")[0],img=$("<img />")[0],editor.intent=!0,img.onload=function(){t.width=this.width,t.height=this.height,u=this,ctx.drawImage(this,0,0),editor.reloadCanvas()},img.src=webkitIntent.data,"http://webintents.org/share"!=webkitIntent.action&&"http://webintents.org/save"!=webkitIntent.action||$("#share").trigger("click"))},v.text.begin=function(t){v.status="started",r=t.x,c=t.y,$("#text_helper").remove(),$('<div id=text_helper style="position:absolute;border:none">adf</div>').appendTo("#divCanvasData"),x1=r,y1=c,x2=t.x,y2=t.y,x1<x2?(rx1=x1,rx2=x2):(rx1=x2,rx2=x1),y1<y2?(ry1=y1,ry2=y2):(ry1=y2,ry2=y1),$("#text_helper").css({"z-index":1e4,left:-m.rx1+rx1-8,top:-m.ry1+ry1-8,height:m.ry2-c,width:m.rx2-r}),b=["left","top","z-index","width","height","position","font-weight","width","fontWeight"];var e=$("<textarea></textarea>");for(i in b)e.css(b[i],$("#text_helper").css(b[i]));e.css({"background-color":"transparent",padding:0,margin:0,border:"none",color:p,"font-size":"15pt","font-weight":"400"}),e.mousedown(function(t){t.stopImmediatePropagation()}),e.appendTo("#divCanvasData").focus(),$("#text_helper").remove(),e.blur(v.text.finish)},v.text.finish=function(){O(),L(),C.type="text",a={text:$("textarea").val(),font:$("textarea").css("font-size")+" "+$("textarea").css("font-family"),"font-size":$("textarea").css("font-size"),"font-weight":$("textarea").css("font-weight"),lineHeight:$("textarea").css("line-height"),width:$("textarea").css("width"),x:r,y:c,direction:$("textarea").css("direction")},C=$.extend(C,a),$("textarea").remove(),v[v.current].draw({canvas:t,ctx:o,data:C},"toolcreate"),v.status="ready",$("textarea").unbind("blur")},v.text.draw=function(t,e){t.ctx.textBaseline="top",t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.font=t.data.font,lineHeight=t.ctx.font=parseInt(t.data["font-size"]);t.data.text.split("\n");check=multiFillText(t.canvas,t.data.text,null,null,parseInt(lineHeight),parseInt(t.data.width)),e&&(W(t.canvas,t.data.x,t.data.y,1e4,1e4),t.canvas.width=check.width,t.canvas.height=check.height+10),t.ctx.textBaseline="top",t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.font=t.data.font,context=t.ctx,context.shadowColor="black",context.shadowBlur=0,context.shadowOffsetX=0,context.shadowOffsetY=0,multiFillText(t.canvas,t.data.text,e?0:t.data.x-m.rx1,e?0:t.data.y-m.ry1,parseInt(lineHeight),parseInt(t.data.width)),context.shadowOffsetX=0,context.shadowOffsetY=0,context.shadowBlur=0,P()},v.crop.begin=function(t){v.status="started",r=t.x,c=t.y},v.crop.click=function(){A()},v.crop.up=function(){ry2-ry1+rx2-rx1<100?v.crop.draw():(m.rx1=rx1,m.rx2=rx2,m.ry1=ry1,m.ry2=ry2,O(),C.type="crop",v.crop.draw())},v.crop.draw=function(t){$("#crop_helper").remove(),A(),$("#divCanvasData").scrollTop(0).scrollLeft(0),v.status="ready",F()},v.crop.move=function(t){x1=r,y1=c,x2=t.x,y2=t.y,$("#divCanvasData").scrollTop()+$("#divCanvasData").height()-t.y<35&&($("#divCanvasData")[0].scrollTop+=30,t.y+=30),$("#divCanvasData").scrollLeft()+$("#divCanvasData").width()-t.x<35&&($("#divCanvasData")[0].scrollLeft+=30,t.x+=30),t.y-$("#divCanvasData").scrollTop()<35&&($("#divCanvasData")[0].scrollTop-=30,t.y-=30),t.x-$("#divCanvasData").scrollLeft()<35&&($("#divCanvasData")[0].scrollLeft-=30,t.x-=30),x1<x2?(rx1=x1,rx2=x2):(rx1=x2,rx2=x1),y1<y2?(ry1=y1,ry2=y2):(ry1=y2,ry2=y1),$("#crop_helper").remove(),$("<div id=crop_helper><div id=crop_helper_bottom></div><div id=crop_helper_left></div><div id=crop_helper_top></div><div id=crop_helper_right></div></div>").appendTo("#divCanvasData"),$("#crop_helper *").css({"background-color":"black",opacity:"0.6",position:"absolute","z-index":1999999999}),$("#crop_helper_left").css({"ackground-color":"blue",left:0,top:s.position().top,top:0,width:rx1-m.rx1,height:s.height()+h}),$("#crop_helper_top").css({"ackground-color":"red",left:rx1-m.rx1,top:0,width:m.rx2-(rx1-m.rx1),height:ry1-m.ry1}),$("#crop_helper_bottom").css({"ackground-color":"yellow",left:rx1-m.rx1,top:ry2-m.ry1,width:m.rx2-(rx1-m.rx1),height:m.ry2-ry2}),$("#crop_helper_right").css({"ackground-color":"green",left:rx2-m.rx1,top:ry1-m.ry1,width:m.rx2-(rx2-m.rx1),height:ry2-ry1})},v.spray.begin=function(t){v.status="started",O(),L(),C.type="spray",C.points=[],v.spray.move(t)},v.spray.move=function(e){for(var a=35*o.lineWidth;a>0;a--){var n=e.x+Math.round(Math.random()*(15*o.lineWidth)-2*o.lineWidth),i=e.y+Math.round(Math.random()*(15*o.lineWidth)-2*o.lineWidth);C.points.push({x:n,y:i})}ans=R(C.points),W(t,ans.x1,ans.y1,ans.x2,ans.y2),v[v.current].draw({canvas:t,ctx:o,data:C})},v.spray.draw=function(t){for(var e,a=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),o=a.data,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t.data.color),i=[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],s=0;s<t.data.points.length;s++)e=parseInt(t.data.points[s].y-t.data.canvasOffset.y-10)*t.canvas.width*4,o[e+=4*parseInt(t.data.points[s].x-t.data.canvasOffset.x-10)]=i[0],o[e+1]=i[1],o[e+2]=i[2],o[e+3]=255;t.ctx.putImageData(a,0,0),P()},v.spray.up=function(){v.status="ready"},v.free.up=function(){v.status="ready"},v.free.begin=function(t){v.status="started",O(),L(),C.type="free",C.points=[],v.free.move(t)},v.free.move=function(e){C.points.push({x:e.x,y:e.y}),t.height=t.height+1,t.height=t.height-1,ans=R(C.points),W(t,ans.x1,ans.y1,ans.x2,ans.y2),v[v.current].draw({canvas:t,ctx:o,data:C})},v.free.draw=function(t){context=t.ctx,context.shadowBlur=5,context.shadowOffsetX=5,context.shadowOffsetY=5,context.lineWidth=t.data.lineWidth,t.ctx.beginPath(),t.ctx.strokeStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.fillStyle=t.data.color;for(var e=1;e<t.data.points.length;e++)t.ctx.lineTo(t.data.points[e].x-t.data.canvasOffset.x,t.data.points[e].y-t.data.canvasOffset.y);t.ctx.stroke(),t.ctx.closePath(),context.shadowOffsetX=0,context.shadowOffsetY=0,context.shadowBlur=0,P()},v.highlight.up=function(){v.status="ready"},v.highlight.begin=function(t){v.status="started",O(),L(),C.type="highlight",C.points=[],v.highlight.move(t)},v.highlight.move=function(e){C.points.push({x:e.x,y:e.y}),t.height=t.height+1,t.height=t.height-1,ans=R(C.points),W(t,ans.x1,ans.y1,ans.x2,ans.y2),v[v.current].draw({canvas:t,ctx:o,data:C})},v.highlight.draw=function(t){context=t.ctx,context.shadowBlur=5,context.shadowOffsetX=5,context.shadowOffsetY=5,context.globalAlpha=.45,t.ctx.lineWidth=20,t.ctx.beginPath(),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color;for(var e=1;e<t.data.points.length;e++)t.ctx.lineTo(t.data.points[e].x-t.data.canvasOffset.x,t.data.points[e].y-t.data.canvasOffset.y);t.ctx.stroke(),t.ctx.closePath(),context.shadowOffsetX=0,context.shadowOffsetY=0,context.shadowBlur=0,P()},v.line.begin=function(t){v.status="started",O(),L(),C.type="line",C.start={x:t.x,y:t.y}},v.line.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x,C.start.y,C.end.x,C.end.y),v[v.current].draw({canvas:t,ctx:o,data:C})},v.line.draw=function(t){t.data.start&&t.data.end&&(t.ctx.beginPath(),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.lineWidth=t.data.lineWidth,H=function(e,a,o,n,i){t.ctx.lineWidth=t.data.lineWidth,i?(t.ctx.strokeStyle="000",t.ctx.globalAlpha=.2):(H(e+shadowDistance,a+shadowDistance,o+shadowDistance,n+shadowDistance,!0),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1),t.ctx.beginPath(),t.ctx.moveTo(e,a),t.ctx.lineTo(o,n),t.ctx.stroke(),t.ctx.closePath()},context=t.ctx,context.shadowBlur=5,context.shadowOffsetX=5,context.shadowOffsetY=5,H(t.data.start.x-t.data.canvasOffset.x,t.data.start.y-t.data.canvasOffset.y,t.data.end.x-t.data.canvasOffset.x,t.data.end.y-t.data.canvasOffset.y),t.ctx.lineCap="round",t.ctx.stroke(),t.ctx.closePath(),context=t.ctx,context.shadowBlur=0,context.shadowOffsetX=0,context.shadowOffsetY=0,P())},v.line.up=function(){v.status="ready"};v.ellipsis.begin=function(t){v.status="started",O(),L(),t.x-=15,t.y-=15,C.type="ellipsis",C.start={x:t.x,y:t.y},C.end={x:t.x+30,y:t.y+30},v.ellipsis.move({x:t.x+30,y:t.y+30})},v.ellipsis.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x,C.start.y,C.end.x,C.end.y),v[v.current].draw({canvas:t,ctx:o,data:C})},v.ellipsis.draw=function(t){t.data.start&&t.data.end&&(t.ctx.beginPath(),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.ellipsisWidth=t.data.ellipsisWidth,drawEllipsis=function(e,a,o,n,i){if(t.ctx.lineWidth=t.data.lineWidth,!i){drawEllipsis(e+shadowDistance,a+shadowDistance,o+shadowDistance,n+shadowDistance,!0),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.beginPath();var s=(Math.sqrt(2)-1)/3*4,r=(o-e)/2,c=(n-a)/2,d=e+r,l=a+c,h=t.ctx;h.beginPath(),h.moveTo(d,l-c),h.bezierCurveTo(d+s*r,l-c,d+r,l-s*c,d+r,l),h.bezierCurveTo(d+r,l+s*c,d+s*r,l+c,d,l+c),h.bezierCurveTo(d-s*r,l+c,d-r,l+s*c,d-r,l),h.bezierCurveTo(d-r,l-s*c,d-s*r,l-c,d,l-c),t.ctx.stroke(),t.ctx.closePath()}},drawEllipsis(t.data.start.x-t.data.canvasOffset.x,t.data.start.y-t.data.canvasOffset.y,t.data.end.x-t.data.canvasOffset.x,t.data.end.y-t.data.canvasOffset.y),t.ctx.ellipsisCap="round",t.ctx.stroke(),t.ctx.closePath(),P())},v.ellipsis.up=function(){v.status="ready"};function P(){var e=$(t).data("img"),a=$(t);e.css({marginTop:a.css("marginTop"),marginLeft:a.css("marginLeft"),position:"absolute",left:a.css("left"),top:a.css("top"),width:a.css("width"),height:a.css("height")}),e.attr("src",t.toDataURL())}v.rectangle.begin=function(t){v.status="started",O(),L(),t.x-=15,t.y-=15,C.type="rectangle",C.start={x:t.x+15,y:t.y+15},C.end={x:t.x+30,y:t.y+30},v.rectangle.move({x:t.x+30,y:t.y+30})},v.rectangle.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x,C.start.y,C.end.x,C.end.y),v[v.current].draw({canvas:t,ctx:o,data:C})},v.rectangle.draw=function(t){t.data.start&&t.data.end&&(context=t.ctx,context.shadowBlur=5,context.shadowOffsetX=5,context.shadowOffsetY=5,function e(a,o,n,i,s){t.ctx.lineWidth=t.data.lineWidth,s||(e(a+shadowDistance,o+shadowDistance,n+shadowDistance,i+shadowDistance,!0),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.beginPath(),t.ctx.moveTo(a,o),t.ctx.lineTo(a,i),t.ctx.lineTo(n,i),t.ctx.lineTo(n,o),t.ctx.lineTo(a,o),"full"==t.data.type?t.ctx.fill():t.ctx.stroke(),t.ctx.closePath())}(t.data.start.x-t.data.canvasOffset.x,t.data.start.y-t.data.canvasOffset.y,t.data.end.x-t.data.canvasOffset.x,t.data.end.y-t.data.canvasOffset.y),context=t.ctx,context.shadowBlur=0,context.shadowOffsetX=0,context.shadowOffsetY=0,t.ctx.lineCap="round",P())},v.rectangle.up=function(){v.status="ready"},v.full.begin=function(t){v.status="started",O(),L(),C.type="full",t.x-=15,t.y-=15,C.start={x:t.x+15,y:t.y+15},C.end={x:t.x+30,y:t.y+30},v.full.move({x:t.x+30,y:t.y+30})},v.full.move=v.rectangle.move,v.full.draw=v.rectangle.draw,v.full.up=v.rectangle.up;v.star.begin=function(t){v.status="started",O(),L(),C.type="star",C.start={x:t.x-15+15,y:t.y-15+15},C.end={x:t.x+15,y:t.y+15},v.star.move(t)},v.star.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x-(C.end.x-C.start.x)/2,C.start.y-(C.end.y-C.start.y)/2,C.end.x+2*(C.end.x-C.start.x),C.end.y+2*(C.end.y-C.start.y)),v[v.current].draw({canvas:t,ctx:o,data:C})},v.star.draw=function(t){var e,a,o,n;t.data.start&&t.data.end&&(e=t.data.start.x-t.data.canvasOffset.x,a=t.data.start.y-t.data.canvasOffset.y,o=t.data.end.x-t.data.canvasOffset.x,n=t.data.end.y-t.data.canvasOffset.y,t.ctx.lineWidth=t.data.lineWidth,t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.drawSvg('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="200px" height="200px" viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve"><g>\t<path d="M98.88,21.851l23.207,47.022l1.629,3.3l3.642,0.529l51.893,7.541l-37.549,36.602l-2.636,2.569l0.622,3.627l8.864,51.683l-46.414-24.402l-3.258-1.712l-3.257,1.712l-46.414,24.402l8.865-51.683l0.622-3.628l-2.635-2.568L18.51,80.243l51.893-7.541l3.642-0.529l1.629-3.3L98.88,21.851 M98.88,6.034L69.396,65.775l-65.929,9.58l47.707,46.502L39.912,187.52l58.968-31.002l58.969,31.002l-11.262-65.662l47.705-46.502l-65.928-9.58L98.88,6.034L98.88,6.034z"/></g></svg>',e,a,2*(o-e),2*(n-a)),P())},v.star.up=function(){v.status="ready"};function W(t,e,a,o,n){return e<o?(rx1=e,rx2=o):(rx1=o,rx2=e),a<n?(ry1=a,ry2=n):(ry1=n,ry2=a),C.canvasOffset={x:rx1-7,y:ry1-7},$(t).css({left:rx1-7,top:ry1-7}),t.width=rx2-rx1+25,t.height=ry2-ry1+25,$(t).data("img").css({left:$(t).css("left"),top:$(t).css("top"),width:t.width,height:t.height}),{x:rx1,y:ry1}}function _(){"started"==v.status&&(B(v[v.current].up),B(v[v.current].finish))}function U(t){"undo"==t.type&&"redo"==t.type&&"crop"==t.type||(localStorage.lastTool=t),_(),$(".button [tag="+t+"]").trigger("mousedown"),v.current=t}function B(t){$.isFunction(t)&&t()}function A(){canvasWidth=m.rx2-m.rx1,canvasHeight=m.ry2-m.ry1,$("#clipper").css({height:m.ry2-m.ry1,overflow:"hidden",width:m.rx2-m.rx1,position:"absolute"}),u&&($("#canvasId").attr("height",m.ry2-m.ry1),$("#canvasId")[0].getContext("2d").drawImage(u,0,0)),s.css({"margin-left":-m.rx1,"margin-top":-m.ry1}),s.css({clip:"clip.rect("+m.ry1+" "+m.rx2+" "+m.ry2+" "+m.rx1+")"}).css("position","absolute"),$("canvas").add("#clipper img").not("#canvasId").each(function(){$(this).css({"margin-left":-m.rx1,"margin-top":-m.ry1})}),maxWidth=window.innerWidth,maxHeight=window.innerHeight-$("#header").height()-$("#fotter").height(),$("#header").add("#fotter").width(maxWidth),divCanvasData=$("#divCanvasData");var t=canvasHeight;t>maxHeight&&(t=maxHeight),divCanvasData.css({left:canvasWidth>maxWidth?0:maxWidth/2-canvasWidth/2,width:canvasWidth>maxWidth?maxWidth:canvasWidth,height:t,"overflow-x":canvasWidth+16<maxWidth?"hidden":"auto","overflow-Y":canvasHeight<maxHeight?"hidden":"auto",top:"50%","margin-top":$("#header").height()/2-t/2+"px"}),l=canvasWidth<maxWidth?0:16,d=canvasHeight<maxHeight?0:16,z()}function F(){$("#border1")[($("#border1").off().on("click",function(){$(this).toggleClass("on")}),0!=m.rx1&&0!=m.ry1?"show":"hide")](),$(".button[tag=undo]").attr("status",T>-1?"on":"Disable"),$(".button[tag=undo]")[T>-1?"removeClass":"addClass"]("disable"),$(".button[tag=redo]").attr("status",D>T?"on":"Disable"),$(".button[tag=redo]")[D>T?"removeClass":"addClass"]("disable"),$("#toolbar .button").each(function(){$(this).attr("title",$(this).attr("tag")),"on"==$(this).attr("status")?($(this).attr({src:"images/drawing/"+$(this).attr("tag")+($(this).attr("tag")==v.current?"On":"Off")+".png"}).css({cursor:"pointer"}),$(this)[$(this).attr("tag")==v.current?"addClass":"removeClass"]("on")):$(this).attr({src:"images/drawing/"+$(this).attr("tag")+"Disable.png"}).css({cursor:"not-allowed"})})}function z(){$("#divCanvasData").scrollLeft(),h=$("#divCanvasData").scrollTop()}function j(){$(".linePickerOverlay hr").click(function(){g=parseInt(this.style.height),$(".linePickerOverlay").hide()}),$(".save-to-pdf").click(createPDF),$("#thumbnail").click(createThumbnails),$("#LineWidthPicker").mouseenter(function(){var t=$(".linePickerOverlay");t.is(":visible")||t.show(50)}).mouseleave(function(){$(".linePickerOverlay").hide()}),$(".donation").click(function(t){t.preventDefault(),$(".donation-drop").toggle()}),$(".more-plugins").click(function(t){t.preventDefault(),$(".more-plugins-drop").toggle()}),$("body").click(function(t){t.isDefaultPrevented()||$(".donation-drop, .more-plugins-drop").hide()}),$(document.body).bind("mousedown",function(t){if(0==t.button){var e=I(t);if(e||_(),e&&"text"==v.current&&_(),e&&"ready"==v.status&&v[v.current].begin(e),"page-editor"==t.delegateTarget.id)return!1}}),$(document.body).bind("mousemove",function(t){dime=I(t),$("#divCanvasData").css("default"),$("#divCanvasData").css("cursor","default"),dime&&("ready"!=v.status&&"started"!=v.status||$("#divCanvasData").css("cursor","crosshair"),"started"==v.status&&$.isFunction(v[v.current].move)&&v[v.current].move(dime))}),$(window).resize(A),$(document.body).bind("mouseup",function(t){dime=I(t),v.current&&B(v[v.current].up)}),$("#toolbar .button").click(function(){$this=$(this),"on"==$this.attr("status")&&(U($this.attr("tag")),$.isFunction(v[$this.attr("tag")].click)&&v[$this.attr("tag")].click(),$this.attr({src:"images/drawing/"+$this.attr("tag")+"On.png"}),$this.addClass("on"),F())}),$("#divCanvasData").bind("scroll",z),$("#a_share").click(function(){E()}),$("#save").click(N),$("#open").click(X)}function E(t){t=t||"",function(){$("#topText").html('uploading <a href="#" id=a_cancel>Cancel</a>');$("canvas.done")[0];var e=screenshot.url,a=localStorage.options;$.ajax({url:"https://www.webpagescreenshot.info/upload3.asp",type:"post",data:{type:localStorage.pngjpg,title:screenshot.title,description:screenshot.description,imageUrl:e,options:a,data:canvasToDataURL,service:t},complete:function(e,a,o){if(w)return $("#topText").html("Canceled!"),void $("#save").add("#toGoogleDrive").add("#print").attr("disabled",null);Y();var n=e.responseText.replace(/^\s+|\s+$/g,"");if(/"/.test(n)||/>/.test(n)||/</.test(n)||/'/.test(n)||0!=n.indexOf("http:"))$("#topText").html("Please try again in some minutes. We are working to solve this issue.");else{if(w)return;n=n.split(","),imageURL=n[0],imageURL,imageDelete=n[1],shareService(t,imageURL)}A()}})}()}function H(){o.strokeStyle="rgba(0,0,0,0.1)",o.moveTo(100,100),o.lineTo(300,300),o.stroke()}function N(){"text"==localStorage.lastTool?U("line"):U(localStorage.lastTool),M(),window.setTimeout(function(){editor.createLastCanvas("save")},0)}function M(){w=!1,$("#serviceButtons button").attr("disabled","true").css({cursor:"default",border:"none"}),$("#topText").html("Working..")}function Y(){$("#serviceButtons button").attr("disabled",null).css({cursor:"",border:""}),$("#topText").html(""),w=!1}function X(){"text"==localStorage.lastTool?U("line"):U(localStorage.lastTool),M(),window.setTimeout(function(){editor.createLastCanvas("open")},0)}v.house.begin=function(t){v.status="started",O(),L(),C.type="house",C.start={x:t.x-15,y:t.y-15},C.end={x:t.x+30,y:t.y+30},v.house.move(t)},v.house.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x-(C.end.x-C.start.x)/2,C.start.y-(C.end.y-C.start.y)/2,C.end.x+(C.end.x-C.start.x),C.end.y+(C.end.y-C.start.y)),v[v.current].draw({canvas:t,ctx:o,data:C})},v.house.draw=function(t){var e,a,o,n;t.data.start&&t.data.end&&(e=t.data.start.x-t.data.canvasOffset.x,a=t.data.start.y-t.data.canvasOffset.y,o=t.data.end.x-t.data.canvasOffset.x,n=t.data.end.y-t.data.canvasOffset.y,t.ctx.lineWidth=2*t.data.lineWidth,t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.drawSvg('<svg version="1.1" xmlns="http://www.w3.org/2000/svg"  x="0px" y="0px" width="200px" height="148.333px" viewBox="0 0 200 148.333" enable-background="new 0 0 200 148.333" xml:space="preserve"><polyline fill="none" stroke="#strokeColor#"  points="32.875,56.208 33.248,56.838 33.248,137.203 168.183,137.203 168.183,56.838 \t\t"/> <polyline  fill="none" stroke="#strokeColor#" points="194.936,77.92 147.189,43.877 99.444,9.833 51.699,43.877 3.952,77.92 \t\t"/>  </svg>'.replace(/#strokeColor#/g,t.data.color),e,a,2*(o-e),2*(n-a)),P())},v.house.up=function(){v.status="ready"},v.arrow.begin=function(t){v.status="started",O(),L(),C.type="arrow",C.start={x:t.x,y:t.y}},v.arrow.move=function(e){C.end={x:e.x,y:e.y},t.height=t.height+1,t.height=t.height-1,W(t,C.start.x,C.start.y,C.end.x,C.end.y),v[v.current].draw({canvas:t,ctx:o,data:C})},v.arrow.draw=function(t){t.data.start&&t.data.end&&(!function e(a,o,n,i,s){if(t.ctx.lineWidth=t.data.lineWidth,s)return t.ctx.strokeStyle="000",void(t.ctx.globalAlpha=.2);e(a+shadowDistance,o+shadowDistance,n+shadowDistance,i+shadowDistance,!0),t.ctx.strokeStyle=t.data.color,t.ctx.fillStyle=t.data.color,t.ctx.globalAlpha=1,t.ctx.beginPath(),t.ctx.moveTo(a,o),t.ctx.lineTo(n,i);var r=n-a,c=i-o,d=Math.sqrt(r*r+c*c);t.ctx.lineTo(n-8*c/d-7*r/d,i+8*r/d-7*c/d),t.ctx.lineTo(n+7*r/d,i+7*c/d),t.ctx.lineTo(n+8*c/d-7*r/d,i-8*r/d-7*c/d),t.ctx.lineTo(n,i),t.ctx.stroke(),t.ctx.closePath()}(t.data.start.x-t.data.canvasOffset.x,t.data.start.y-t.data.canvasOffset.y,t.data.end.x-t.data.canvasOffset.x,t.data.end.y-t.data.canvasOffset.y),t.ctx.lineCap="round",P())},v.arrow.up=function(){v.status="ready"}}localStorage.lastTool||(localStorage.lastTool="crop");var editor=new editor_obj;localStorage.captureCount++,editor.window=window,editor.close=window.close,editor.captureCount=localStorage.captureCount,$(function(){editor.init(),extension.online&&(editor.appick||editor.webcam||editor.intent||window.setTimeout(screenshot.createScreenShot,0))});var googleAuth,createFile=function(t){if((screenshot.title||screenshot.url).replace(/[%&\(\)\\\/\:\*\?\"\<\>\|\/\]]/g," "),"-"+(new Date).getHours().toString().twoDigits()+(new Date).getMinutes().toString().twoDigits()+(new Date).getSeconds().toString().twoDigits(),"png"==localStorage.pngjpg?".png":".jpg",window.createByPlugin){var e=0,a=function(){var t,o;if((t=document.createElement("embed")).width=t.height=1,t.type="application/x-webpagescreenshot",document.body.appendChild(t),(o=document.createElement("embed")).type="application/x-screencapture",o.width=o.height=1,document.body.appendChild(o),o.SaveScreenshot)return o.SaveScreenshot(canvasToDataURL,"Save image"),$("#topText").html("Image Saved!<br/><img src=/images/logo_twitter.png height=20 style=vertical-align:middle>&nbsp;<a href=http://twitter.com/home?status=Check%20out%20this%20Chrome%20extesnion%20%22Webpage%20Screenshot%22%2C%20http://bit.ly/cF6sYP%20save%20PNG%20screenshots%20of%20any%20webpage.>Tweet about it</a>"),onResize(),$("#save").add("#toGoogleDrive").add("#print").attr("disabled",""),!0;if(t.sendKey){try{t.sendKey("B1E883D1AC7C3606B4660A4D3D2765C9".toLowerCase())}catch(e){try{t.sendKey("A587C0A90DE83822E695F02DD90B908E".toLowerCase())}catch(t){}}return saveNow=new findAndShowDirs,saveNow.plugin=t,saveNow.onChoose=function(e){t.setPath(e),fileName+="png"==localStorage.pngjpg?".png":".jpg",n=t.saveBase64(fileName,canvasToDataURL.slice(canvasToDataURL.indexOf(",")+1)),$("#topText").html("Image Saved!<br/><img src=/images/logo_twitter.png height=20 style=vertical-align:middle>&nbsp;<a href=http://twitter.com/home?status=Check%20out%20this%20Chrome%20extesnion%20%22Webpage%20Screenshot%22%2C%20http://bit.ly/cF6sYP%20save%20PNG%20screenshots%20of%20any%20webpage.>Tweet about it</a>"),onResize(),$("#save").add("#toGoogleDrive").add("#print").attr("disabled","")},saveNow.onClose=function(){onResize(),$("#save").add("#toGoogleDrive").add("#print").attr("disabled","")},fileName=prompt("Enter a filename (without '.png' or '.jpg')\nFor example: 'screenshot1'."),fileName?saveNow.saveStart():$("#save").add("#toGoogleDrive").add("#print").attr("disabled",""),!0}try{e&&(window.clearTimeout(e),e=0)}catch(t){}try{document.body.removeChild(t)}catch(t){}try{document.body.removeChild(o)}catch(t){}return e=window.setTimeout(a,500),!1};a()||($("#topText").html("For saving you must install Plugin"),$(".arrow_"+extension.dir).show(),window.setTimeout(function(){$(".cArrow").hide()},3e3),$("#save").add("#print").add("#toGoogleDrive").attr("disabled",""))}else{var o=dataURItoBlob(canvasToDataURL),n=URL.createObjectURL(o);t(n)}},multiFillText=function(t,e,a,o,n,i){var s=t.getContext("2d"),r=null!==a&&null!==o;e=e.replace(/(\r\n|\n\r|\r|\n)/g,"\n"),sections=e.split("\n");var c,d,l,h,u,p=0,g=0,x=function(t){r&&s.fillText(t,a,o+n*p),p++,(l=s.measureText(t).width)>g&&(g=l)};for(c=0;c<sections.length;c++){for(h=sections[c].split(" "),index=1;h.length>0&&index<=h.length;)d=h.slice(0,index).join(" "),(l=s.measureText(d).width)>i?(1===index?(d=h.slice(0,1).join(" "),h=h.splice(1)):(d=h.slice(0,index-1).join(" "),h=h.splice(index-1)),x(d),index=1):index++;index>0&&x(h.join(" "))}if(u=n*p,!r)return{height:u,width:g}};function gDrive(){start=function(){$("#topText").html("Uploading..."),googleAuth.authorize(function(){googleAuth.getAccessToken(),xhr=new XMLHttpRequest,xhr.open("POST","https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart",!0),xhr.setRequestHeader("Authorization","OAuth "+googleAuth.getAccessToken());var t={title:screenshot.title,mimeType:"image/png"},e=287032396531387,a=[];a.push("--"+e),a.push("Content-Type: application/json"),a.push(""),a.push(JSON.stringify(t)),a.push("--"+e),a.push("Content-Type: image/png"),a.push("Content-Transfer-Encoding: base64"),a.push(""),a.push(canvasToDataURL.slice(22)),a.push("--"+e+"--"),xhr.setRequestHeader("Content-Type","multipart/mixed; boundary="+e),xhr.onload=function(t){console.log("DRIVE OK",this,t),(t=JSON.parse(this.response)).error?(googleAuth.clear(),imageURL=JSON.parse(this.response).id,$("#save").add("#print").add("#open").add("#toGoogleDrive").attr("disabled",""),$("#topText").html("Cannot Access;,<a id=trygdrive href=#> try Again</a>."),$("#trygdrive").click(gDrive)):(link=t.alternateLink,$("#save").add("#print").add("#open").add("#toGoogleDrive").attr("disabled",""),chrome.tabs.create({url:link}),$("#topText").html(""),$("#save").add("#print").add("#open").add("#toGoogleDrive").attr("disabled",""),$("#topText").html(""),xh=new XMLHttpRequest,xh.open("POST","https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyC5S6Uxzx6oUxIEHMWZU4eOm7mL6DupChw"),xh.setRequestHeader("Authorization","OAuth "+googleAuth.getAccessToken()),xh.setRequestHeader("Content-Type","application/json"),xh.onload=function(t){imageURL=JSON.parse(this.response).id,$("#save").add("#print").add("#open").add("#toGoogleDrive").attr("disabled",""),$("#topText").html('Saved: <a target="_blank" href='+imageURL+" style=font-size:10px;>"+imageURL+"</a><br/>")},xh.send('{"longUrl":"'+link+'"}'))},theParts=a.join("\r\n"),xhr.send(theParts)})},$("#topText").html("Authorize"),googleAuth=new OAuth2("google",{client_id:"545443912834-j7vdfe6gar81lu14oatf33tgtlcbi5gq.apps.googleusercontent.com",client_secret:"213pVJTRShuSGESsRO92G1qV",api_scope:"https://www.googleapis.com/auth/drive.install https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/urlshortener https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email"},start)}function l(t){}$(function(){$(".hovermenu").sethover()}),$.fn.sethover=function(t){function e(t){var e,a,o;setoff=function(){l(t.length),$(t).off("mouseenter")},seton=function(){$(t).on("mouseenter",showHover)},showHover=function(){l("mousenter");var t=$(this);clearTimeoutFN=function(){console.log("clear-hide"),e&&window.clearTimeout(e)},hideTimeoutFN=function(){clearTimeoutFN(),console.log("set-hide"),e=window.setTimeout(function(){e=!1,o.remove(),a.add(o).fadeOut("fast"),t.add("newdiv").off(".hovermenu"),seton()},300)},this.donthide=function(){clearTimeoutFN(),t.add(a).off(".hovermenu")},a=t.data("hover")||$(this).find(".menu"),t.data("hover",a),$(a).add(this).off(".hovermenu").on({"mouseleave.hovermenu":hideTimeoutFN,"mouseenter.hovermenu":clearTimeoutFN}),$("a",a).on("click",function(){}),a.show(),a.position({my:"right top+10",at:"right bottom",of:this}),o=$("<div class=sss style=position:absolute;background-repeat:no-repeat;width:16px;height:16px;background-image:url(old/nd/ui_top_triangle.png)></div>"),$(this).find(".sss").remove(),$(this).append(o),o.position({my:"right bottom",at:"right-10 top+2",of:a}),a=a.add(o),getH=a.height(),window.hz=window.hz||10,a.css({"z-index":window.hz++,overflow:"hidden"})},seton()}this.each(function(){new e($(this))})},$(function(){var t=defaultPlugins.slice();t.push({name:"FrameBench",key:"framebench",url:"https://app.framebench.com/add-file?link={image_url}",dataType:"image"}),t.push({name:"Reddit",key:"reddit",url:"reddit.com/submit?url=?%s",dataType:"image"});var a=new Toolbar({plugins:t,element:document.getElementById("toolbarContainer"),namespace:"editor",enlargable:!1,page_title:screenshot.title,page_description:screenshot.description,page_url:screenshot.url,doNotRenderDefaults:!0,whiteIcons:!0,button_size:20,icon_base:"/images/",position:"static",type:"image",theme:!0,request:function(t){editor.createLastCanvas("toolbar",function(e){t(e)})},requestText:function(t){alert("you asked to get the text"),t()}});$(".share").on("click",function(){var t=a.getPluginByKey("webpagescreenshot");editor.createLastCanvas("toolbar",function(a){t.run(a,e)})}),$(".save").on("click",function(t){var e=a.getPluginByKey("save");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}),$(".save-to-printer").on("click",function(t){var e=a.getPluginByKey("print");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}),$(".save-to-url").on("click",function(t){var e=a.getPluginByKey("uploady");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}),$(".save-to-clipboard").on("click",function(t){var e=a.getPluginByKey("copy");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}),$(".save-to-thumbnail").on("click",createThumbnails),$(".fbUpload").on("click",function(t){var e=a.getPluginByKey("framebench");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}),document.addEventListener("keydown",function(t){if(83==t.keyCode&&(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)){t.preventDefault();var e=a.getPluginByKey("uploady");editor.createLastCanvas("toolbar",function(a){e.run(a,t)})}},!1),"yes"==lj_get("settings","framebench_button")&&$(".fbUpload").show()}),$(function(){$("#sharediv").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:"chrome.google.com/webstore/detail/webpage-screenshot/ckibcdccnfeookdmbahgiakhnjcddpki/"})}),"#paste"==location.hash&&(!function(t){var e;t.event.fix=function(t){return function(e){return 0!==(e=t.apply(this,arguments)).type.indexOf("copy")&&0!==e.type.indexOf("paste")||(e.clipboardData=e.originalEvent.clipboardData),e}}(t.event.fix),e={callback:t.noop,matchType:/image.*/},t.fn.pasteImageReader=function(a){return"function"==typeof a&&(a={callback:a}),a=t.extend({},e,a),this.each(function(){var e;return e=this,t(this).bind("paste",function(t){var o,n;return n=!1,o=t.clipboardData,Array.prototype.forEach.call(o.types,function(t,i){var s,r;if(!n)return t.match(a.matchType)||o.items[i].type.match(a.matchType)?(s=o.items[i].getAsFile(),(r=new FileReader).onload=function(t){return a.callback.call(e,{dataURL:t.target.result,event:t,file:s,name:s.name})},r.readAsDataURL(s),n=!0):void 0})})})}}(jQuery),$(function(){$('<center class=paste_modal style="position:absolute;top:150px;width:100%"><br><span style="padding:20px;font-size:40px;border:1px solid black">Press Ctrl+V to paste an image</span></center>').appendTo(document.body),$("html").pasteImageReader(function(t,e,a){$(".paste_modal").remove();var o=document.createElement("img");o.src=t.dataURL,canvas=$("canvas")[1],img=$("#imgFixForLong")[0],img.onload=function(){canvas.width=this.width,canvas.height=this.height,firstImage=this,canvas.getContext("2d").drawImage(this,0,0),editor.reloadCanvas()},img.src=o.src})})(jQuery)),$(function(){"#capture"==location.hash&&(alert("You can capture any window, just make sure it's not minimized.\nThis feature is still in a beta, so please contact me and share your experience"),chrome.desktopCapture.chooseDesktopMedia(["window","screen"],function(t){t&&navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxWidth:3e3,maxHeight:3e3}}},function(t){video=document.createElement("video"),video.src=URL.createObjectURL(arguments[0]),window.setTimeout(function(){cs=document.createElement("canvas"),cs.width=video.videoWidth,cs.height=video.videoHeight,cs.getContext("2d").drawImage(video,0,0,cs.width,cs.height),t.stop(),image=document.createElement("img"),image.src=cs.toDataURL(),canvas=$("canvas")[1],img=$("#imgFixForLong")[0],img.onload=function(){canvas.width=this.width,canvas.height=this.height,firstImage=this,canvas.getContext("2d").drawImage(this,0,0),editor.reloadCanvas()},img.src=image.src},500)},function(){})}))}),$(function(){window.setTimeout(function(){$(document).trigger("resize")},100)}),function(){var t=$.ajax;$.ajax=function(){return arguments[0].url=arguments[0].url.replace("https://www.webpage","http://www.webpage"),t.apply(this,arguments)}}();