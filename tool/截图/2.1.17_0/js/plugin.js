var buttons_colors=["#F3B200","#77B900","#2572EB","#AA4344","#7F6E94","#199900","#FF981D","#AA40FF","#91D100","#E1B700","#FF76BC","#56C5FF","#00C13F","#FE7C22"];function createPluginFromObject(t){return window.extStorageGet||(window.extStorageGet=function(t){return localStorage[t]},window.extStorageSet=function(t,e){return localStorage[t]=e}),t.key?t.onclick||t.url?t.name?(dataTypes=t.dataType||"",dataTypes=dataTypes.replace(/text/g,""),dataTypes=dataTypes.replace(/image_url/g,""),dataTypes=dataTypes.replace(/image/g,""),dataTypes=dataTypes.replace(/page/g,""),dataTypes=dataTypes.replace(/image_base64/g,""),dataTypes=dataTypes.trim(dataTypes),dataTypes.length>0?{error:"Cannot recognize dataType: "+dataTypes}:{plugin:t=$.extend({dataType:"text image_url",isDataType:function(t){return this.dataType.toLowerCase().indexOf(t.toLowerCase())>-1},dataTypes:function(){return this.dataType.split(" ")},run:function(e,n){if(this.toolbar){var i=this.toolbar.namespace+"_"+this.key+"_run";extStorageGet(i)||extStorageSet(i,0),extStorageSet(i,parseInt(extStorageGet(i),10)+1),chrome.runtime&&(chrome.runtime.sendMessage({data:"ana",array:["set","pluginClicks",extStorageGet(i)]}),chrome.runtime.sendMessage({data:"ana",array:["send","event","pluginRun",this.name]}))}for(var o in sb)this[o]=sb[o];var a=t;if(a.event=n,a.page_title=this.toolbar&&this.toolbar.page_title||$("title").text()||"no title",a.page_description=this.toolbar&&this.toolbar.page_description||$("meta[name=description]").attr("content")||"",a.page_url=this.toolbar&&this.toolbar.page_url||location.toString(),this.isDataType("text"))a.text=e,a.dataType="text",this.onclick?this.onclick(a):this.url&&this.createTabWithParams(this.url,e,a);else if(this.isDataType("image")){a.image_url=function(t){var e=this.image_data();this.toolbar&&e==this.toolbar.last_image_data?t(this.toolbar.last_image_url):$.ajax({url:"https://www.webpagescreenshot.info/upload3.asp",type:"post",data:{type:"png",title:a.page_title,description:a.page_description,imageUrl:a.page_url,options:extStorageGet("options"),data:e}}).done(function(n,i,o){var r=n.replace(/^\s+|\s+$/g,"");/"/.test(r)||/>/.test(r)||/</.test(r)||/'/.test(r)||0!=r.indexOf("http:")?alert("error in upload"):(r=r.split(","),imageURL=r[0],a.toolbar&&(a.toolbar.last_image_data=e,a.toolbar.last_image_url=imageURL),t(imageURL))})},a.image_base64=function(t){var e=this.image_data(),n=e.slice(e.indexOf(",")+1);return t&&t(n),n};if(a.image_blob=function(){return function(t){for(var e=atob(t),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/png"})}(a.image_base64())},(Array.isArray(e)||e.jquery)&&(e=e[0]),"string"==typeof e&&"data"==e.slice(0,4))a.image_data=function(t){return t&&t(e),e};else if(e.nodeType){var r;"IMG"==e.tagName&&((r=document.createElement("canvas")).width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0)),"CANVAS"==e.tagName&&(r=e),"CANVAS"==e.tagName||"IMG"==e.tagName?a.image_data=function(t){var e=r.toDataURL();return t&&t(e),e}:alert("plugin tag get no supported:"+e.tagName)}this.url&&a.image_url(function(t){a.createTabWithParams(a.url,t,a)}),this.onclick&&("image"==this.dataType&&(a.dataType="image"),this.onclick(a))}else this.onclick&&this.onclick(a)}},t)}):{error:'You must add a "name" key',id:2}:{error:"You don't have a onclick function or url key",id:1}:{error:'You Don\'t have a "key" key',id:4}}function isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}sb={applyClass:function(t){loadRangy(),rangy.createCssClassApplier(t,!0).applyToSelection()},createTabWithParams:function(t,e,n){var i=this.url;i=(i=(i=(i=(i=(i=i.replace(/{image_url}/g,"%c")).replace(/{page_url}/g,encodeURIComponent(this.page_url))).replace(/{page_title}/g,encodeURIComponent(this.page_title))).replace(/{page_description}/g,encodeURIComponent(this.page_description))).replace(/{text}/g,encodeURIComponent(this.text))).replace(/%s/g,e).replace("%c",encodeURIComponent(e.replace("img","i3"))).replace(/%t/g,encodeURIComponent(n.title)),this.createTab(i)},createTab:function(t){window.open(t,"_blank")},dialog:function(t,e){t=$(t),$("input",t).not("[type=password]").inputLoadAndRemember(this);var n=$.extend({},e,{element:t,ui:"dialog",title:this.name}),i=new Dialog(n);return i.show(),$("input",i.contentDocument).first().focus(),i},dialog3:function(t){t=$(t),$("input",t).not("[type=password]").inputLoadAndRemember(this),iframe=document.createElement("iframe").appendTo(document.body),iframe.style.position="absolute",iframe.frameBorder=0,document.body.appendChild(iframe),$(iframe).position({of:document});var e=$('<div style=width:inherit class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable"><div style=cursor:default class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id=title class="ui-dialog-title"></span><button  class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span style=margin:-8px class="ui-button-icon-primary ui-icon ui-icon-closethick"></span></button></div><div id=content class="ui-dialog-content ui-widget-content"></div></div>');iframe.contentDocument.body.appendChild(e[0]),$("[title=close]",e).click(function(){n()}),$("#content",iframe.contentDocument.body).append(t[0]),$("#title",iframe.contentDocument.body).html("Hello World"),(e=document.createElement("div")).innerHTML='<link rel="stylesheet" href="jquery-ui-1.9.2.custom.min.css"></link><style>body {color:white;}</style>',iframe.contentDocument.body.appendChild(e);var n=function(){iframe.remove()},i=function(t){27==t.keyCode&&n(),document.removeEventListener("keyup",i)};document.addEventListener("keyup",i),iframe.contentDocument.addEventListener("keyup",i);iframe.style.height=iframe.contentDocument.height+"px",iframe.style.width=iframe.contentDocument.width+"px",$("input",iframe.contentDocument).first().focus()},dialog2:function(t){return t=$(t).wrap('<div class="noCss">').parent(),$("input",t).not("[type=password]").inputLoadAndRemember(this),$("button",t).button(),t.dialog({modal:!0,minWidth:460,title:this.name+" - Selection Bar"}),$(t)},storageGet:function(t,e){var n,i=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+t;return void 0===(n=extStorageGet?extStorageGet(i):localStorage[i])&&(n=e),isNumber(n)?parseFloat(n):n},storageSetDefault:function(t,e){null==this.storageGet(t)&&this.storageSet(t,e)},storageSet:function(t,e){var n=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+t;return extStorageSet?extStorageSet(n,e):localStorage[n]=e}};var sb_plugins={};function addObjectToPlugins(t){Array.isArray(t)||(t=[t]),$.each(t,function(){newPlugin=createPluginFromObject(this),newPlugin.error?console.log("cannot add plugin, error",newPlugin.error):(newPlugin=newPlugin.plugin,sb_plugins[newPlugin.key]=newPlugin)})}function Toolbar(t){loadjQueryThings(),this.obj_plugins={};var e="",n=[];if(e=$('<div class="plugin-toolbar"></div>'),!t.theme){var i="background: #fff;box-shadow: 0 2px 2px rgba(0,0,0,0.15);border: 1px #aaaaab solid;border-radius: 0px;display:inline-block;";t.whiteIcons&&(i+="padding-top:3px;"),e.attr("style",i)}var o,a,r=this;var l=function(){r.isMax()?(a.show(),o.hide(),$(".tb_button",e).parent().show()):(a.hide(),o.show(),$(".tb_button",e).parent().hide().slice(0,t.min_buttons_num).show())};this.isMax=function(){return"yes"==r.storageGet("isMax")},this.addPlugins=function(t){Array.isArray(t)||(t=[t]),$.each(t,function(t,e){var n=createPluginFromObject(e);n.error?console.log("cannot add plugin, error",n.error,n):((n=n.plugin).toolbar=r,r.obj_plugins[n.key]=n)})},this.removeToolbar=function(){$(t.element).html(""),$(document).off("click",r.removeToolbar)};this.getPluginByKey=function(t){if(this.obj_plugins[t])return this.obj_plugins[t]},this.storageGet=function(t,e){var n,i=(this.namespace&&"toolbarnonamespace")+"_"+t;return void 0===(n=extStorageGet?extStorageGet(i):localStorage[i])&&(n=e),isNumber(n)?parseFloat(n):n},this.storageSetDefault=function(t,e){null==this.storageGet(t)&&this.storageSet(t,e)},this.storageSet=function(t,e){var n=(this.namespace&&"toolbarnonamespace")+"_"+t;return extStorageSet?extStorageSet(n,e):localStorage[n]=e},function(){for(var i in n=t.type.split(" "),t=$.extend({},{icon_base:"icons/",lines:1,min_buttons_num:2,zIndex:2e4,button_size:15},t))this[i]=t[i];if(this.request==this.request||this.requestImage,this.addPlugins(t.plugins),"static"==this.position&&(function(){var i;e.html(""),e.css("z-index",r.zIndex);var s=0,c=0;$.each(r.obj_plugins,function(t,e,i){for(var o in this.dataTypes=this.dataType.split(" "),n)for(var a in this.dataTypes)n[o]==this.dataTypes[a]&&c++});var d=-1;$.each(r.obj_plugins,function(o,a,l){if(!t.doNotRenderDefaults||!this.editorDefault){var u=!1;for(var p in n)for(var g in this.dataTypes)n[p]==this.dataTypes[g]&&(u=!0);if(u){if(t.theme)i=$('<div class="tb_button" plugin-key="'+this.key+'"><img src='+r.icon_base+this.key+".png ></div>");else{var h=t.whiteIcons?"padding: 4px 3px;margin-bottom: 3px;margin-left: 3px;margin-right: 2px;background: #fff;float: left;border: none;color: #fff;height: 20px;line-height: 20px;border-radius: 0px;cursor: pointer;box-sizing: content-box;float:left;":"float:left";i=$('<div style="'+h+'"><div style=display:none;font-size:10px;font-family:arial;text-align:center>'+this.name+'</div><img class=tb_button plugin-key="'+this.key+'"src='+r.icon_base+this.key+".png ></div>")}s++,$("img,div",i).attr("width",t.button_size+"px"),$("img,div",i).attr("height",t.button_size+"px"),$("img,div",i).css({width:t.button_size+"px",height:t.button_size+"px","border-right":"none","border-left":"none","border-bottom":"none","box-sizing":"content-box",padding:t.whiteIcons?"0":"5px",float:"left"}),i.attr("title",this.name);var m=this;m.$=i;var f=$("img",i).on({error:function(){},mouseenter:function(){},mouseleave:function(){"down"!=m.state&&$(this).removeClass("hover")},"mousedown mouseup":function(t){t.stopPropagation()},click:function(t){"Range"==window.getSelection().type&&(text=window.getSelection().getRangeAt(0).toString()),r.keepDown&&"down"!=m.state?($.each(r.obj_plugins,function(t,e){"down"==e.state&&(e.state="up")}),e.find("img").css("background","#fff"),f.css("background","#4BBAFF"),m.state="down",r.active=m):r.keepDown&&"down"==m.state&&(m.state="up",r.active=null,f.css("background","#fff")),r.request(function(e){!1===m.closeOnClick&&t.stopPropagation(),m.run(e,t)},m)}});d++,!0===t.colors&&(thisColorIndex=d,thisColorIndex>=buttons_colors.length&&(thisColorIndex=0),$("img",i).css("backgroundColor",buttons_colors[thisColorIndex])),e.append(i),Math.round(c/this.toolbar.lines+1)==s&&i.css("clear","both")}}}),t.enlargable&&(o=$('<div style=cursor:pointer;float:left><img style="margin:-5px"  src='+r.icon_base+"right.png></div>"),a=$('<div style=cursor:pointer;float:left><img style="width:15px; height:15px;padding: 5px; box-sizing: content-box;float: left" src='+r.icon_base+"left.png></div>"),e.append(o).append(a),l(),o.add(a).find("img").css("height",t.button_size).on("mousedown",function(t){t.stopPropagation()}),o.on("click",function(t){return r.storageSet("isMax","yes"),l(),!1}),a.on("click",function(t){return r.storageSet("isMax","no"),l(),!1}))}(),$(t.element).append(e),t.pushDown)){e.css({position:"fixed",top:"0px",left:"0px",borderTop:"none",borderLeft:"none",borderTopRightRadius:"0px"});var c=$(e).height()+5;$("*").filter(function(){return"fixed"===$(this).css("position")}).not(e).css("margin-top",function(t,e){return parseInt(e)+c});var d=(parseInt($("tml").css("margin-top"))||0)+c;try{s=document.createElement("style"),document.getElementsByTagName("html")[0].appendChild(s),s.innerText="@media print {.ws_toolbar_top {display:none}} @media screen {html {margin-top:"+d+"px;position:relative}"}catch(t){}}t.closeOnClick&&window.setTimeout(function(){$(document).on("click",r.removeToolbar)},0)}.call(this)}function appendStyle(t,e){style=document.createElement("style"),e&&(style.media=e),style.innerText=t,document.body&&document.body.appendChild(style)}function appendFirstStyle(){style=document.createElement("style");appendStyle(".tb_button {padding:1px;cursor:pointer;border-right: 1px solid #8b8b8b;border-left: 1px solid #FFF;border-bottom: 1px solid #fff;}.tb_button.hover {borer:2px outset #def; background-color: #f8f8f8 !important;}.ws_toolbar {z-index:100000} .ws_toolbar .ws_tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden} .ws_toolbar img {padding:2px;margin:0px}")}jQueryThingsLoaded=!1,loadjQueryThings=function(){jQueryThingsLoaded||(jQueryThingsLoaded=!0,$.ajaxPrefilter(function(t,e,n){if(t.showProgress){var i=$("<center class=progresscancel><div>Saving Online...<br><div style=height:20px;background-color:skyblue name=progressbar></div><button name=cancel>Cancel</button></div></center>"),o=new Dialog({title:"Uploading",ui:"dialog",element:i,onclose:function(){n.abort()}}).show(),a=$("[name=progressbar]",i);a.css({width:"0%"}),t.xhr=function(){var t=new XMLHttpRequest;return t.upload.onprogress=function(t){var e;t.total,t.loaded;e=t.loaded/t.total*98,a.css({width:e+"%"})},t},n.fail(function(){$("[name=status]",i).html("Cannot upload. Try again later")}),n.done(function(){o.remove()}),$("[name=cancel]",i).click(function(){o.remove(),n.abort()})}}),$.ajaxSetup({showProgress:!0}),$.fn.inputLoadAndRemember=function(t){this.each(function(){this.getAttribute("name").length<1?console.log('Every input must have "name" Attribute'):($(this).val(t.storageGet(this.getAttribute("name"))),$(this).on("input",function(){t.storageSet(this.getAttribute("name"),$(this).val())}))})})},"complete"==document.readyState?appendFirstStyle():window.addEventListener("load",appendFirstStyle);