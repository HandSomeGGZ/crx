var api={stop:!1,init:function(){api.setDefaultSettings(),screenshot.init(),codeinjector.init(),api.listenMessages(),api.gatherStats()},setDefaultSettings:function(){var e={pngjpg:"png",delay:0,rnd:Math.random(),options:hex_md5((new Date).toString())+hex_md5(Math.random().toString()),speed:400,shortcut_full:90,shortcut_visible:88,shortcut_region:82,enableshortcuts:"yes",button_size:14,sb_opacity:.7,created:new Date,captureWithScroll:0,captureWithoutScroll:0,color:"#FF0000",captureCount:0,txtHeader:"",txtFotter:""};for(var t in e)e.hasOwnProperty(t)&&!localStorage.hasOwnProperty(t)&&(localStorage[t]=e[t]);chrome.i18n.getAcceptLanguages(function(){try{localStorage.primaryLanguage=arguments[0][0]}catch(e){localStorage.primaryLanguage=""}})},isEnableURL:function(e){return"yes"==localStorage.sb_enable&&(!!(e=cleanUp(e))&&"disabled"!=JSON.parse(localStorage.sb_disableURLs||"{}")[e])},gatherStats:function(){},executeIfPermission:function(e,t){chrome.permissions.contains({permissions:["tabs"]},function(a){a?e():t&&t()})},include:function(e){var t=document.createElement("script");t.src=chrome.extension.getURL(e),document.head.appendChild(t)},callPopup:function(e){for(var t=chrome.extension.getViews({type:"popup"}),a=0;a<t.length;a++)t[a].popup.exec(e)},copyTextToClipboard:function(e){premissions.checkPermissions({permissions:["clipboardWrite"]},function(){var t=$("<textarea/>");t.text(e),$("body").append(t),t.select(),document.execCommand("copy",!0),t.remove()})},listenMessages:function(){chrome.runtime.onMessage.addListener(function(e,t,a){switch(api.stop=!1,e.data){case"createTabAndCloseCurrent":chrome.tabs.remove(t.tab.id,function(){}),chrome.tabs.create({url:e.url});break;case"captureVisible":screenshot.captureVisible($.extend({},e,{callback:a}));break;case"captureAll":screenshot.captureAll($.extend({},e,{callback:a}));break;case"captureRegion":screenshot.captureRegion();break;case"captureWebcam":screenshot.captureWebcam();break;case"captureDesktop":screenshot.captureDesktop();break;case"captureClipboard":screenshot.captureClipboard();break;case"editContent":screenshot.editContent();break;case"stopNow":api.stop=!0;break;case"ana":ga.apply(window,e.array);break;case"copyText":api.copyTextToClipboard(e.text);break;case"storageGet":a(localStorage);break;case"storageSet":localStorage[e.key]=e.val;break;case"upload":objectUrlToBlob(e.objectURL,function(t){return e.blob=t,droplr.upload(e).then(a,a)});break;case"connectUploady":uploady.connectUser().then(a);break;case"isEnableShortCuts":"yes"===localStorage.enableshortcuts&&a();break;default:console.warn("Invalid message",e)}return!0}),chrome.commands.onCommand.addListener(function(e){switch(e){case"screenshot":screenshot.captureVisible({callback:noop});break;case"full_page_screenshot":screenshot.captureAll({callback:noop});break;case"range_page_screenshot":screenshot.captureRegion()}})}};api.init(),window.setInterval(function(){chrome.runtime.requestUpdateCheck(function(){"update_available"==arguments[0]&&chrome.runtime.reload()})},36e5);