var jqWindowsEngineZIndex=100;jQuery.extend({newWindow:function(n){var t=0,i=0,o="";""!=(n=$.extend({id:"",title:"",width:300,height:300,posx:50,posy:50,content:"",onDragBegin:null,onDragEnd:null,onResizeBegin:null,onResizeEnd:null,onAjaxContentLoaded:null,onWindowClose:null,statusBar:!0,minimizeButton:!0,maximizeButton:!0,closeButton:!0,draggable:!0,resizeable:!0,type:"normal"},n)).id&&(o='id="'+n.id+'"'),""!=n.id&&(o='id="'+n.id+'"'),$windowContainer=$("<div "+o+' class="window-container"></div>'),$titleBar=$('<div class="window-titleBar"></div>'),$titleBar.append('<div class="window-titleBar-leftCorner"></div>'),$titleBarContent=$('<div class="window-titleBar-content">'+n.title+"</div>"),$titleBar.append($titleBarContent),$titleBar.append('<div class="window-titleBar-rightCorner"></div>'),$windowMinimizeButton=$('<div class="window-minimizeButton"></div>'),$windowMaximizeButton=$('<div class="window-maximizeButton"></div>'),$windowCloseButton=$('<div class="window-closeButton"></div>'),$windowContent=$('<div class="window-content"></div>'),$windowStatusBar=$('<div class="window-statusBar"></div>'),$windowResizeIcon=$('<div class="window-resizeIcon"></div>'),n.minimizeButton&&$titleBar.append($windowMinimizeButton),n.maximizeButton&&$titleBar.append($windowMaximizeButton),n.closeButton&&$titleBar.append($windowCloseButton),n.resizeable&&$windowStatusBar.append($windowResizeIcon),$windowContainer.append($titleBar),$windowContent.append(n.content),$windowContainer.append($windowContent),n.statusBar&&$windowContainer.append($windowStatusBar),"iframe"===n.type&&$windowContent.css("overflow","hidden");var e=function(n){n.css("z-index",jqWindowsEngineZIndex++)},a=function(t,i,o){(i=parseInt(i))<n.width&&(i=n.width),(o=parseInt(o))<n.height&&(o=n.height),t.data("lastWidth",i).data("lastHeight",o),t.css("width",i+"px").css("height",o+"px"),"iframe"===n.type&&t.find("iframe").css("width",i-3+"px").css("height",o-2+"px")},d=function(n,t,i){t=parseInt(t),i=parseInt(i),n.data("lastX",t).data("lastY",i),i<0&&(i=0),t+="px",i+="px",n.css("left",t).css("top",i)};$titleBarContent.bind("mousedown",function(o){$obj=$(o.target).parent().parent(),e($obj),"maximized"!=$obj.data("state")&&(o=o||window.event,t=o.clientX,i=o.clientY,$(document).bind("mousemove",function(o){!function(o,e){if(n.draggable){o=o||window.event;var a=parseInt(e.css("left"))+(o.clientX-t),w=parseInt(e.css("top"))+(o.clientY-i);t=o.clientX,i=o.clientY,d(e,a,w)}}(o,$obj)}),$(document).bind("mouseup",function(t){null!=n.onDragEnd&&n.onDragEnd(),$(document).unbind("mousemove"),$(document).unbind("mouseup")}),null!=n.onDragBegin&&n.onDragBegin())}),$titleBarContent.dblclick(function(n){$obj=$(n.target).parent().parent(),$obj.find(".window-maximizeButton").click()}),$windowResizeIcon.bind("mousedown",function(o){$obj=$(o.target).parent().parent(),e($obj),"normal"===$obj.data("state")&&(o=o||window.event,t=o.clientX,i=o.clientY,$(document).bind("mousemove",function(n){!function(n,o){n=n||window.event;var e=parseInt(o.css("width")),d=parseInt(o.css("height"));d=d<50?50:d;var w=(e=e<100?100:e)+(n.clientX-t),s=d+(n.clientY-i);t=n.clientX,i=n.clientY,a(o,w,s)}(n,$obj)}),$(document).bind("mouseup",function(t){null!=n.onResizeEnd&&n.onResizeEnd(),$(document).unbind("mousemove"),$(document).unbind("mouseup")}),null!=n.onResizeBegin&&n.onResizeBegin())}),$windowMinimizeButton.bind("click",function(n){$obj=$(n.target).parent().parent(),e($obj),"minimized"===$obj.data("state")?($obj.data("state","normal"),$obj.css("height",$obj.data("lastHeight")),$obj.find(".window-content").slideToggle("slow")):"normal"===$obj.data("state")?($obj.data("state","minimized"),$obj.find(".window-content").slideToggle("slow",function(){$obj.css("height",0)})):$obj.find(".window-maximizeButton").click()}),$windowMaximizeButton.bind("click",function(t){$obj=$(t.target).parent().parent(),e($obj),"minimized"===$obj.data("state")?$obj.find(".window-minimizeButton").click():"normal"===$obj.data("state")?($obj.animate({top:"5px",left:"5px",width:$(window).width()-15,height:$(window).height()-45},"slow"),"iframe"===n.type&&$obj.find("iframe").animate({top:"5px",left:"5px",width:$(window).width()-15-3,height:$(window).height()-45-2},"slow"),$obj.data("state","maximized")):"maximized"===$obj.data("state")&&($obj.animate({top:$obj.data("lastY"),left:$obj.data("lastX"),width:$obj.data("lastWidth"),height:$obj.data("lastHeight")},"slow"),"iframe"===n.type&&$obj.find("iframe").animate({top:$obj.data("lastY"),left:$obj.data("lastX"),width:parseInt($obj.data("lastWidth")-3),height:parseInt($obj.data("lastHeight")-2)},"slow"),$obj.data("state","normal"))}),$windowCloseButton.bind("click",function(t){var i=$(t.target).parent().parent();i.hide(function(){i.remove()}),null!=n.onWindowClose&&n.onWindowClose()}),$windowContent.click(function(n){e($(n.target).parent())}),$windowStatusBar.click(function(n){e($(n.target).parent())}),$windowContainer.data("state","normal"),$windowContainer.css("display","none"),$("body").append($windowContainer),$window=$windowContainer,n.draggable||$window.children(".window-titleBar").css("cursor","default"),e($window),d($windowContainer,n.posx,n.posy),a($windowContainer,n.width,n.height),$window.fadeIn()},updateWindowContent:function(n,t){$("#"+n+" .window-content").html(t)},updateWindowContentWithAjax:function(n,t,i){i=void 0===i,$.ajax({url:t,cache:i,dataType:"html",success:function(t){$("#"+n+" .window-content").html(t),null!=options.onAjaxContentLoaded&&options.onAjaxContentLoaded()}})},moveWindow:function(n,t,i){$obj=$("#"+n),t=parseInt(t),i=parseInt(i),$obj.data("lastX",t).data("lastY",i),t+="px",i+="px",$obj.css("left",t).css("top",i)},resizeWindow:function(n,t,i){$obj=$("#"+n),t=parseInt(t),i=parseInt(i),$obj.data("lastWidth",t).data("lastHeight",i),t+="px",i+="px",$obj.css("width",t).css("height",i)},minimizeWindow:function(n){$("#"+n+" .window-minimizeButton").click()},maximizeWindow:function(n){$("#"+n+" .window-maximizeButton").click()},showWindow:function(n){$("#"+n+" .window-closeButton").fadeIn()},hideWindow:function(n){$("#"+n+" .window-closeButton").fadeOut()},closeWindow:function(n){$("#"+n+" .window-closeButton").click()},closeAllWindows:function(){$(".window-container .window-closeButton").click()}});